version: "{build}"
skip_tags: true
image: Visual Studio 2019
configuration: Release

install:
  - dotnet --info
  - choco install codecov -y

before_build:
  - dotnet restore
  - dotnet tool restore

build:
  verbosity: minimal

test_script:
  - dotnet test --configuration Release /p:AltCover=true /p:AltCoverForce=true"

after_test:
  - FOR /D /r %%G in ("src/*.Tests") DO dotnet codecov -f "src\%%~nxG\coverage.xml"

on_failure:
  - FOR /D /r %%G in ("src/*.Tests") DO dotnet codecov -f "src\%%~nxG\coverage.xml"

before_package:
  - dotnet pack

artifacts:
  - path: "src/**/*.nupkg"
    name: NuGet
    type: NuGetPackage

deploy:
  provider: NuGet
  api_key:
    secure: fjBIR3on0h9DhbjsADq4JmfReuYticuhhcbm8/HTsC9Jah8tu5MZPJukBKWLeO0Z
  skip_symbols: false
  server: https://www.myget.org/F/modsink/api/v2/package
  symbol_server: https://www.myget.org/F/modsink/symbols/api/v2/package
