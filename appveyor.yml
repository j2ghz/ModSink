version: '{build}'
skip_tags: true
image: Visual Studio 2019 Preview
configuration: Release

install:
  - choco install dotnetcore-sdk --pre -y
  - dotnet --info
  - choco install gitversion.portable -pre -y
  - choco install codecov

before_build:
  - gitversion /l console /output buildserver /updateAssemblyInfo
  - msbuild /t:Clean /v:m
  - msbuild /t:Restore /v:m

build:
  verbosity: minimal

test_script:
  - FOR /D /r %%G in ("src/*.Tests") DO dotnet test "src\%%~nxG\%%~nxG.csproj" --configuration Release /p:AltCover=true /p:AltCoverForce=true && codecov -f "src\%%~nxG\coverage.xml"