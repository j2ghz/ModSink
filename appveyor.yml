version: '{build}'
skip_tags: true
image: Visual Studio 2019 Preview
configuration: Release

install:
  - choco install dotnetcore-sdk --pre -y
  - dotnet --info
  - choco install gitversion.portable -pre -y
  - choco install codecov -y

before_build:
  - gitversion /l console /output buildserver /updateAssemblyInfo
  - dotnet restore

build:
  verbosity: minimal

test_script:
  - dotnet test --configuration Release /p:AltCover=true /p:AltCoverForce=true"

after_test:
  - FOR /D /r %%G in ("src/*.Tests") DO codecov -f "src\%%~nxG\coverage.xml"

on_failure:
  - FOR /D /r %%G in ("src/*.Tests") DO codecov -f "src\%%~nxG\coverage.xml"

before_package:
  - dotnet pack

artifacts:
  - path: 'src/**/*.nupkg'
    name: NuGet
    type: NuGetPackage

deploy:
  provider: NuGet
  api_key:
    secure: 0qma94N6qhtA51t5XjDxMZlZl0asYFwqbLugZi7dO5taQZoqLohzmd55EJWH87FL
  skip_symbols: false