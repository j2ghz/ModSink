version: '{build}'
skip_tags: true
image: Visual Studio 2019 Preview
configuration: Release

install:
  - git tag | foreach-object -process { git tag -d $_ } 
  - git tag
  - git fetch --all
  - git tag
  - dotnet --info
  - choco install gitversion.portable -pre -y
  - choco install codecov

before_build:
  - ps: gitversion /l console /output buildserver /updateAssemblyInfo /diag
  - ps: msbuild /t:Clean
  - ps: msbuild /t:Restore /v:m

build:
  verbosity: minimal

artifacts:
- path: src/ModSink.WPF/bin/Release/netcoreapp3.0
  name: ModSink.WPF

test_script:
- cmd: dotnet test "src\ModSink.Common.Tests\ModSink.Common.Tests.csproj" --configuration Release --no-build /p:AltCover=true /p:AltCoverForce=true
- cmd: codecov -f "src\ModSink.Common.Tests\coverage.xml"
- cmd: dotnet test "src\ModSink.UI.Tests\ModSink.UI.Tests.csproj" --configuration Release --no-build /p:AltCover=true /p:AltCoverForce=true
- cmd: codecov -f "src\ModSink.UI.Tests\coverage.xml"

deploy:
- provider: GitHub
  auth_token:
    secure: TLChfAMJcjhyw7dQ6WNllA/sc420Hq4fk9V9/VUD1kFOm4ZJpfiBlwaqdVRPbQeP
  artifact: ModSink.WPF
  prerelease: true
  on:
    branch: master
